"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compareArrays=exports.validateSearchParams=exports.randInt=exports.shuffle=exports.tryParseJSON=exports.jsonfy=exports.resolveSite=void 0;const Constants_1=require("./Constants"),fast_xml_parser_1=require("fast-xml-parser");function resolveSite(r){if("string"!=typeof r)return null;r=r.toLowerCase();for(const t in Constants_1.sites)if(t===r||Constants_1.sites[t].domain===r||Constants_1.sites[t].aliases.includes(r))return t;return null}exports.resolveSite=resolveSite;const xmlParser=new fast_xml_parser_1.XMLParser({ignoreAttributes:!1,attributeNamePrefix:""});function jsonfy(r){if("object"==typeof r)return r;const t=xmlParser.parse(r);if(t.html||t["!doctype"]){const r=t.html||t["!doctype"]?.html,e=[];throw r.body.h1&&e.push(r.body.h1),r.body.p&&e.push(r.body.p["#text"]),new Constants_1.BooruError(`The Booru sent back an error: '${e.join(": ")}'`)}return t.posts.post?t.posts.post:t.posts.tag?Array.isArray(t.posts.tag)?t.posts.tag:[t.posts.tag]:[]}function tryParseJSON(r){return""===r?[]:JSON.parse(r)}function shuffle(r){let t,e,s=r.length;for(;0!==s;)e=Math.floor(Math.random()*s),s-=1,t=r[s],r[s]=r[e],r[e]=t;return r}function randInt(r,t){return r=Math.ceil(r),t=Math.floor(t),Math.floor(Math.random()*(t-r+1))+r}function validateSearchParams(r,t){const e=resolveSite(r);if("number"!=typeof t&&(t=parseInt(t,10)),null===e)throw new Constants_1.BooruError("Site not supported");if("number"!=typeof t||Number.isNaN(t))throw new Constants_1.BooruError("`limit` should be an int");return{site:e,limit:t}}function compareArrays(r,t){return r.filter((r=>t.some((t=>r.toLowerCase()===t.toLowerCase()))))}exports.jsonfy=jsonfy,exports.tryParseJSON=tryParseJSON,exports.shuffle=shuffle,exports.randInt=randInt,exports.validateSearchParams=validateSearchParams,exports.compareArrays=compareArrays;